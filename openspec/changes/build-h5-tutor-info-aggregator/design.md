## Context

本变更覆盖采集、解析、标准化、检索展示与任务可观测全链路，属于跨模块协同能力建设。当前系统是 Java 17 + Maven 多模块项目（`facade`、`infrastructure`、`service`、`bootstrap`），首期约束为 MyBatis（非 MyBatis-Plus）、不引入 Redis、仅交付 H5 Web 端。

核心业务约束包括：
- 需要稳定执行“每日自动监测公众号新文章并采集”的定时任务；
- 需要支持手动输入文章 URL 的补采，并纳入同一任务体系；
- 需处理不规则文本与字段缺失，标准化后仍可追溯原文；
- 采集与展示必须满足合规边界，并保留后续下架与纠错扩展能力。
- 目标公众号首期仅 1 个，且为公开免费文章，不依赖平台 token。

## Goals / Non-Goals

**Goals:**
- 建立端到端数据链路：文章发现与采集 -> 文本解析与标准化 -> H5 查询展示。
- 提供统一任务域模型，覆盖自动任务与手动补采任务的创建、执行、失败重试与审计追踪。
- 提供可扩展的解析规则框架，先保证可用性与可迭代性，再逐步提升准确率。
- 为后续小程序通过 web-view 复用 H5 页面提供稳定 API 与数据契约。

**Non-Goals:**
- 不建设管理后台可视化系统。
- 不实现推荐算法、用户体系、支付/撮合闭环。
- 不引入 Redis 或复杂分布式调度编排能力。
- 不实现去重合并、失效判定与上下架生命周期管理（后续迭代再补）。

## Decisions

### 决策 1：采用“任务驱动”的分层流水线，而非同步串行采集
- 选择：以任务表驱动采集与解析流程，任务状态覆盖 `PENDING/RUNNING/SUCCESS/FAILED/PARTIAL_SUCCESS`，自动/手动任务统一落库。
- 原因：同步串行模式在失败恢复、追踪与重试方面成本高，任务化便于审计、重放和逐步扩展。
- 备选方案：直接在定时任务内同步完成采集与解析。放弃原因是可观测性与恢复能力不足。

### 决策 1.1：首期只采集单一目标公众号，基于公开页面能力，不引入 token 机制
- 选择：首期配置单公众号来源，采集入口包含定时扫描与手动 URL 补采；仅使用公开可访问页面与文章链接，不接入账号 token 或授权流程。
- 原因：当前业务已确认仅有一个目标公众号且文章免费公开，优先保证可落地与稳定运行。
- 备选方案：多公众号平台化接入 + 授权 token 管理。放弃原因是超出 MVP 范围，增加接入与运维复杂度。

### 决策 2：解析采用“规则引擎 + 兜底片段保留”，而非一次性强结构化
- 选择：先基于正则/词典/模式匹配抽取核心字段，缺失字段允许为空；同时保存原始片段（raw snippets）用于回溯与人工校验。
- 原因：公众号文本格式不稳定，先保障高召回与可追溯，避免早期过拟合导致大量漏识别。
- 备选方案：强约束模板解析或 NLP 重模型。放弃原因是依赖重、维护成本高、上线周期长。

### 决策 3：MVP 暂不做去重与生命周期，默认记录均上线展示
- 选择：本期不实现去重合并、不维护 ACTIVE/OFFLINE/EXPIRED 等状态字段，不做失效判定；前台默认展示全部已采集并解析成功的数据。
- 原因：用户明确 MVP 核心是采集与搜索筛选，先保证主链路可用，降低首期复杂度。
- 备选方案：引入软去重与生命周期状态机。放弃原因是增加规则复杂度且不属于当前核心目标。

### 决策 4：H5 查询采用数据库条件检索 + 索引优化，暂不引入缓存
- 选择：基于 MyBatis 动态 SQL 实现关键词搜索、多条件筛选与排序；通过组合索引（状态、发布时间、城市、科目、薪资）保证首期性能。
- 原因：符合“不引入 Redis”的约束，数据规模早期可通过 SQL 与索引满足。
- 备选方案：引入搜索引擎或 Redis 缓存。放弃原因是超出首期范围与运维复杂度。

### 决策 5：薪资按原文字符串存储，发布时间作为时效参考字段
- 选择：薪资字段首期采用字符串原样存储（如“120/2h”“面议”“自报价”），不做数值化建模；仅存发布时间用于“最新优先”排序与时间筛选。
- 原因：薪资表达高度非结构化，先保证信息不丢失与检索可用；用户也明确接受字符串存储。
- 备选方案：拆分最低/最高薪资与单位。放弃原因是规则复杂且容易误解析。

## Risks / Trade-offs

- [公众号页面结构变化导致采集失败率上升] -> Mitigation：采集器增加多策略回退、失败分类日志与告警阈值。
- [解析规则初期准确率不足] -> Mitigation：保留原文片段、建立错误样本池、迭代规则并增加回归用例。
- [查询性能随数据量增长下降] -> Mitigation：先做索引与分页优化，达到阈值后再评估缓存或搜索引擎。
- [合规风险（敏感信息暴露）] -> Mitigation：字段分级展示与日志脱敏，增加下架/纠错快速通道。
- [公开页面结构变更导致无 token 方案失效] -> Mitigation：保留手动 URL 补采兜底，增加采集规则版本与快速回滚。

## Migration Plan

1. 先上线数据库变更（文章原文、任务、结构化信息、发布时间与检索字段），保持向后兼容。
2. 部署采集与解析任务处理链路，先以低频定时运行并观察成功率与失败分类。
3. 开启手动补采接口并与自动任务同库同状态机运行，验证重试链路可用。
4. 上线 H5 查询接口与页面，默认展示全部解析成功数据。
5. 灰度提升自动任务频率，监控采集成功率、解析成功率、去重命中率。

回滚策略：
- 如采集/解析异常，可临时关闭定时任务开关，仅保留查询服务；
- 如新字段导致查询异常，可回退到兼容 SQL（忽略新增字段）；
- 所有历史原文与任务日志保留，支持离线重跑恢复。

## Open Questions

- 目标公众号列表是单一账号还是多账号配置化管理（首期建议单账号，保留扩展点）？
- 手动补采接口的鉴权方式采用现有内部鉴权还是单独 Token（需与安全要求对齐）？
- 目标公众号后续是否需要扩展为多公众号配置化管理？
- 无数值薪资（例如“面议”）在“薪资高/低优先”排序时的相对顺序规则是否固定置后？

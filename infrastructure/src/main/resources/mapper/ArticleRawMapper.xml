<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lin.webtemplate.infrastructure.mapper.ArticleRawMapper">

    <resultMap id="ArticleRawResultMap" type="com.lin.webtemplate.infrastructure.entity.ArticleRawEntity">
        <id property="id" column="id"/>
        <result property="sourceUrl" column="source_url"/>
        <result property="title" column="title"/>
        <result property="publishTime" column="publish_time"/>
        <result property="htmlContent" column="html_content"/>
        <result property="contentText" column="content_text"/>
        <result property="fetchedAt" column="fetched_at"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <insert id="upsert" parameterType="com.lin.webtemplate.infrastructure.entity.ArticleRawEntity">
        MERGE INTO article_raw
            (source_url, title, publish_time, html_content, content_text, fetched_at, created_at, updated_at)
        KEY(source_url)
        VALUES
            (#{sourceUrl}, #{title}, #{publishTime}, #{htmlContent}, #{contentText}, #{fetchedAt}, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
    </insert>

    <select id="findBySourceUrl" resultMap="ArticleRawResultMap">
        SELECT id,
               source_url,
               title,
               publish_time,
               html_content,
               content_text,
               fetched_at,
               created_at,
               updated_at
        FROM article_raw
        WHERE source_url = #{sourceUrl}
    </select>

    <select id="findById" resultMap="ArticleRawResultMap">
        SELECT id,
               source_url,
               title,
               publish_time,
               html_content,
               content_text,
               fetched_at,
               created_at,
               updated_at
        FROM article_raw
        WHERE id = #{id}
    </select>

    <select id="findAll" resultMap="ArticleRawResultMap">
        SELECT id,
               source_url,
               title,
               publish_time,
               html_content,
               content_text,
               fetched_at,
               created_at,
               updated_at
        FROM article_raw
        ORDER BY id DESC
    </select>
</mapper>

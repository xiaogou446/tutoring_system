<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lin.webtemplate.infrastructure.mapper.TutoringInfoMapper">

    <resultMap id="TutoringInfoBasicResultMap" type="com.lin.webtemplate.infrastructure.dataobject.TutoringInfoDO">
        <id column="id" property="id"/>
        <result column="source_url" property="sourceUrl"/>
        <result column="content_block" property="contentBlock"/>
        <result column="published_at" property="publishedAt"/>
    </resultMap>

    <sql id="TutoringInfoQueryCondition">
        <where>
            <if test="contentKeyword != null and contentKeyword != ''">
                AND content_block LIKE CONCAT('%', #{contentKeyword}, '%')
            </if>
            <if test="gradeKeyword != null and gradeKeyword != ''">
                AND grade_snippet LIKE CONCAT('%', #{gradeKeyword}, '%')
            </if>
            <if test="subjectKeyword != null and subjectKeyword != ''">
                AND subject_snippet LIKE CONCAT('%', #{subjectKeyword}, '%')
            </if>
            <if test="addressKeyword != null and addressKeyword != ''">
                AND address_snippet LIKE CONCAT('%', #{addressKeyword}, '%')
            </if>
            <if test="timeKeyword != null and timeKeyword != ''">
                AND time_schedule_snippet LIKE CONCAT('%', #{timeKeyword}, '%')
            </if>
            <if test="salaryKeyword != null and salaryKeyword != ''">
                AND salary_snippet LIKE CONCAT('%', #{salaryKeyword}, '%')
            </if>
            <if test="teacherKeyword != null and teacherKeyword != ''">
                AND teacher_requirement_snippet LIKE CONCAT('%', #{teacherKeyword}, '%')
            </if>
        </where>
    </sql>

    <select id="countByCondition" resultType="long">
        SELECT COUNT(1)
        FROM tutoring_info
        <include refid="TutoringInfoQueryCondition"/>
    </select>

    <select id="pageQuery" resultMap="TutoringInfoBasicResultMap">
        SELECT id, source_url, content_block, published_at
        FROM tutoring_info
        <include refid="TutoringInfoQueryCondition"/>
        ORDER BY published_at
        <choose>
            <when test="sortOrder == 'asc'">ASC</when>
            <otherwise>DESC</otherwise>
        </choose>
        , id DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

</mapper>
